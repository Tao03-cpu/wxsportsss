<view class="admin-container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="admin-header">
    <view class="header-content">
      <view class="header-left">
        <view class="header-icon">âš™ï¸</view>
        <view class="header-text">
          <view class="header-title">ç®¡ç†åå°</view>
          <view class="header-subtitle">{{userInfo.nickname || 'ç®¡ç†å‘˜'}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tabs-container">
    <view class="tabs-wrapper">
      <view class="tab-item {{activeTab==='dashboard'?'active':''}}" data-tab="dashboard" bindtap="switchTab">
        <text class="tab-icon">ğŸ“Š</text>
        <text class="tab-text">ä»ªè¡¨ç›˜</text>
      </view>
      <view class="tab-item {{activeTab==='users'?'active':''}}" data-tab="users" bindtap="switchTab">
        <text class="tab-icon">ğŸ‘¥</text>
        <text class="tab-text">ç”¨æˆ·</text>
      </view>
      <view class="tab-item {{activeTab==='tribes'?'active':''}}" data-tab="tribes" bindtap="switchTab">
        <text class="tab-icon">ğŸ˜ï¸</text>
        <text class="tab-text">éƒ¨è½</text>
      </view>
      <view class="tab-item {{activeTab==='feedback'?'active':''}}" data-tab="feedback" bindtap="switchTab">
        <text class="tab-icon">ğŸ’¬</text>
        <text class="tab-text">åé¦ˆ</text>
      </view>
    </view>
  </view>

  <!-- ä»ªè¡¨ç›˜ -->
  <view wx:if="{{activeTab==='dashboard'}}" class="dashboard-content">
    <!-- æ•°æ®å¡ç‰‡ -->
    <view class="metrics-grid">
      <view class="metric-card card-1">
        <view class="metric-icon">ğŸ‘¤</view>
        <view class="metric-content">
          <view class="metric-value">{{metrics.totalUsers}}</view>
          <view class="metric-label">æ€»ç”¨æˆ·æ•°</view>
        </view>
      </view>
      <view class="metric-card card-2">
        <view class="metric-icon">ğŸ”¥</view>
        <view class="metric-content">
          <view class="metric-value">{{metrics.dauToday}}</view>
          <view class="metric-label">ä»Šæ—¥æ´»è·ƒ</view>
        </view>
      </view>
      <view class="metric-card card-3">
        <view class="metric-icon">ğŸ’¬</view>
        <view class="metric-content">
          <view class="metric-value">{{metrics.messagesToday}}</view>
          <view class="metric-label">ä»Šæ—¥æ¶ˆæ¯</view>
        </view>
      </view>
      <view class="metric-card card-4">
        <view class="metric-icon">âœ…</view>
        <view class="metric-content">
          <view class="metric-value">{{metrics.checkinRateToday}}%</view>
          <view class="metric-label">æ‰“å¡å®Œæˆç‡</view>
        </view>
      </view>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯åŒºåŸŸ -->
    <view class="stats-section">
      <!-- éƒ¨è½ç»Ÿè®¡ -->
      <view class="stat-card">
        <view class="stat-header">
          <view class="stat-title">ğŸ˜ï¸ éƒ¨è½ç»Ÿè®¡</view>
          <view class="stat-subtitle">Tribe Statistics</view>
        </view>
        <view class="stat-content">
          <view class="stat-item">
            <view class="stat-label">éƒ¨è½æ€»æ•°</view>
            <view class="stat-value">{{tribeStats.totalTribes || 0}}</view>
          </view>
          <view class="stat-item">
            <view class="stat-label">æ€»æˆå‘˜æ•°</view>
            <view class="stat-value">{{tribeStats.totalMembers || 0}}</view>
          </view>
          <view class="stat-item">
            <view class="stat-label">å¹³å‡æˆå‘˜æ•°</view>
            <view class="stat-value">{{tribeStats.avgMembers || 0}}</view>
          </view>
        </view>
        <view class="stat-list">
          <view class="stat-list-title">çƒ­é—¨éƒ¨è½</view>
          <block wx:for="{{tribeStats.topTribes}}" wx:key="id" wx:for-item="tribe">
            <view class="stat-list-item">
              <view class="list-item-name">{{tribe.name}}</view>
              <view class="list-item-value">{{tribe.memberCount}}äºº</view>
            </view>
          </block>
          <view wx:if="{{!tribeStats.topTribes || tribeStats.topTribes.length === 0}}" class="stat-empty">æš‚æ— æ•°æ®</view>
        </view>
      </view>

      <!-- è¿åŠ¨ç±»å‹ç»Ÿè®¡ -->
      <view class="stat-card">
        <view class="stat-header">
          <view class="stat-title">ğŸƒ è¿åŠ¨ç±»å‹åˆ†å¸ƒ</view>
          <view class="stat-subtitle">Sport Type Distribution</view>
        </view>
        <view class="stat-content">
          <view class="stat-item">
            <view class="stat-label">æ€»è¿åŠ¨æ¬¡æ•°</view>
            <view class="stat-value">{{sportStats.totalSessions || 0}}</view>
          </view>
          <view class="stat-item">
            <view class="stat-label">æ€»è¿åŠ¨æ—¶é•¿</view>
            <view class="stat-value">{{sportStats.totalDuration || 0}}åˆ†é’Ÿ</view>
          </view>
        </view>
        <view class="stat-list">
          <view class="stat-list-title">è¿åŠ¨ç±»å‹æ’è¡Œ</view>
          <block wx:for="{{sportStats.typeList}}" wx:key="type" wx:for-item="sport">
            <view class="stat-list-item">
              <view class="list-item-name">
                <text class="sport-icon">{{sport.icon}}</text>
                {{sport.label}}
              </view>
              <view class="list-item-value">
                <view class="progress-bar">
                  <view class="progress-fill" style="width: {{sport.percent}}"></view>
                </view>
                <text class="progress-text">{{sport.count}}æ¬¡ ({{sport.percent}}%)</text>
              </view>
            </view>
          </block>
          <view wx:if="{{!sportStats.typeList || sportStats.typeList.length === 0}}" class="stat-empty">æš‚æ— æ•°æ®</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·ç®¡ç† -->
  <view wx:elif="{{activeTab==='users'}}" class="data-content">
    <view class="page-header">
      <view class="page-title">ç”¨æˆ·ç®¡ç†</view>
      <view class="page-desc">ç®¡ç†ç”¨æˆ·ä¿¡æ¯ä¸æƒé™</view>
    </view>
    <view class="users-list">
      <block wx:for="{{users}}" wx:key="_id">
        <view class="user-card">
          <image class="user-avatar" src="{{item.avatarUrl || '/assets/tips-icon.png'}}" mode="aspectFill"></image>
          <view class="user-info">
            <view class="user-name-label">æ˜µç§°</view>
            <input class="user-name-input" value="{{item.nickname}}" data-id="{{item._id}}" bindinput="onUserNickInput" placeholder="è¯·è¾“å…¥æ˜µç§°" />
          </view>
          <view class="user-actions">
            <button class="action-btn save-btn" size="mini" data-id="{{item._id}}" bindtap="saveUserNick">ä¿å­˜</button>
            <button class="action-btn delete-btn" size="mini" type="warn" data-id="{{item._id}}" bindtap="deleteUser">åˆ é™¤</button>
          </view>
        </view>
      </block>
    </view>
    <view class="load-more-wrapper">
      <button class="load-more-btn" bindtap="loadMoreUsers">åŠ è½½æ›´å¤š</button>
    </view>
  </view>

  <!-- éƒ¨è½ç®¡ç† -->
  <view wx:elif="{{activeTab==='tribes'}}" class="data-content">
    <view class="page-header">
      <view class="page-title">éƒ¨è½ç®¡ç†</view>
      <view class="page-desc">åˆ›å»ºå’Œç®¡ç†è¿åŠ¨éƒ¨è½</view>
    </view>
    
    <!-- åˆ›å»ºéƒ¨è½è¡¨å• -->
    <view class="create-tribe-card">
      <view class="form-title">åˆ›å»ºæ–°éƒ¨è½</view>
      <view class="form-row">
        <input class="form-input" placeholder="éƒ¨è½åç§°" value="{{createTribeName}}" bindinput="onCreateTribeName" />
      </view>
      <view class="form-row">
        <input class="form-input" placeholder="éƒ¨è½å£å·ï¼ˆå¯é€‰ï¼‰" value="{{createTribeSlogan}}" bindinput="onCreateTribeSlogan" />
      </view>
      <button class="create-btn" bindtap="createTribe">åˆ›å»ºéƒ¨è½</button>
    </view>

    <!-- éƒ¨è½åˆ—è¡¨ -->
    <view class="tribes-list">
      <block wx:for="{{tribes}}" wx:key="_id">
        <view class="tribe-card">
          <view class="tribe-main">
            <view class="tribe-header">
              <view class="tribe-name">{{item.name}}</view>
              <view class="tribe-badge">éƒ¨è½</view>
            </view>
            <view class="tribe-slogan">{{item.slogan || 'æš‚æ— å£å·'}}</view>
          </view>
          <view class="tribe-actions">
            <button class="action-btn edit-btn" size="mini" data-id="{{item._id}}" bindtap="editTribe">ç¼–è¾‘</button>
            <button class="action-btn delete-btn" size="mini" type="warn" data-id="{{item._id}}" bindtap="deleteTribe">åˆ é™¤</button>
          </view>
        </view>
      </block>
    </view>

    <!-- ç¼–è¾‘é¢æ¿ -->
    <view wx:if="{{editTribeId}}" class="edit-panel">
      <view class="edit-panel-title">ç¼–è¾‘éƒ¨è½</view>
      <view class="form-row">
        <input class="form-input" placeholder="åç§°" value="{{editTribeName}}" bindinput="onEditTribeName" />
      </view>
      <view class="form-row">
        <input class="form-input" placeholder="å£å·" value="{{editTribeSlogan}}" bindinput="onEditTribeSlogan" />
      </view>
      <view class="edit-actions">
        <button class="action-btn save-btn" size="mini" bindtap="saveTribeEdit">ä¿å­˜</button>
        <button class="action-btn cancel-btn" size="mini" bindtap="cancelTribeEdit">å–æ¶ˆ</button>
      </view>
    </view>
  </view>

  <!-- åé¦ˆç®¡ç† -->
  <view wx:elif="{{activeTab==='feedback'}}" class="data-content">
    <view class="page-header">
      <view class="page-title">ç”¨æˆ·åé¦ˆ</view>
      <view class="page-desc">æŸ¥çœ‹å’Œå¤„ç†ç”¨æˆ·åé¦ˆ</view>
    </view>
    <view class="feedbacks-list">
      <block wx:for="{{feedbacks}}" wx:key="_id">
        <view class="feedback-card {{item.status==='resolved'?'resolved':''}}">
          <view class="feedback-header">
            <view class="feedback-type-badge">{{item.type}}</view>
            <view class="feedback-status {{item.status==='resolved'?'status-resolved':'status-pending'}}">
              {{item.status==='resolved'?'å·²å¤„ç†':'å¾…å¤„ç†'}}
            </view>
          </view>
          <view class="feedback-content">{{item.content}}</view>
          <view class="feedback-footer">
            <view class="feedback-meta">
              <text class="meta-item">ğŸ“ {{item.contact || 'æ— è”ç³»æ–¹å¼'}}</text>
              <text class="meta-item">ğŸ• {{item.submitTimeStr}}</text>
            </view>
          </view>
          <view class="feedback-actions">
            <button class="action-btn status-btn" size="mini" data-id="{{item._id}}" data-status="{{item.status==='pending'?'resolved':'pending'}}" bindtap="toggleFeedbackStatus">
              {{item.status==='pending'?'âœ“ æ ‡è®°å·²å¤„ç†':'â†© æ ‡è®°å¾…å¤„ç†'}}
            </button>
            <button class="action-btn delete-btn" size="mini" type="warn" data-id="{{item._id}}" bindtap="deleteFeedback">åˆ é™¤</button>
          </view>
        </view>
      </block>
    </view>
    <view class="load-more-wrapper">
      <button class="load-more-btn" bindtap="loadMoreFeedback">åŠ è½½æ›´å¤š</button>
    </view>
  </view>

  <!-- åº•éƒ¨é€€å‡ºæŒ‰é’® -->
  <view class="logout-section">
    <view class="logout-btn-bottom" bindtap="logout">
      <text class="logout-icon">ğŸšª</text>
      <text class="logout-text">é€€å‡ºç®¡ç†å‘˜æ¨¡å¼</text>
    </view>
  </view>
</view>
